version: 2.1

# Define the jobs we want to run for this project
jobs:

  build:
    docker:
      - image: circleci/node:16.10.0
    steps:
      - run: ssh -o StrictHostKeyChecking=no $SSH_USER@$SSH_HOST && cd ~/via-app && git stash && git pull && yarn refresh-kbs && yarn build && cp -a ./dist/. /var/www/html/via-app

# Orchestrate our job run sequence
workflows:
  version: 2.1
  build-and-deploy:
    jobs:
      - deploy:
          filters:
            branches:
              only: master
